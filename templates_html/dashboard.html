<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>pH Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>pH Dashboard</h2>
  <p><a href="{{ url_for('logout') }}">Logout</a></p>
  <canvas id="phChart" width="800" height="300"></canvas>

  <script>
    const ctx = document.getElementById('phChart').getContext('2d');
    let chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'pH',
          data: [],
          fill: false,
          tension: 0.1
        }]
      },
      options: {
        scales: {
          x: { type: 'time', time: { parser: 'isoDateTime', tooltipFormat: 'YYYY-MM-DD HH:mm' } },
          y: { suggestedMin: 0, suggestedMax: 14 }
        }
      }
    });

    async function fetchData() {
      const res = await fetch('/api/readings?limit=500');
      const arr = await res.json();
      const labels = arr.map(x => x.timestamp);
      const data = arr.map(x => x.ph);
      chart.data.labels = labels;
      chart.data.datasets[0].data = data;
      chart.update();
    }

    // initial
    fetchData();
    // poll (every minute) to keep it near real-time
    setInterval(fetchData, 60*1000);
  </script>
</body>
</html>
